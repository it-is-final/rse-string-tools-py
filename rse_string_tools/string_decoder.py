from rse_string_tools.enums import Version, Language
from rse_string_tools.string_encoder import build_character_map


CHARACTER_MAP_R_JPN = {
    '　': 0x0, 
    'あ': 0x1, 'い': 0x2, 'う': 0x3, 'え': 0x4, 'お': 0x5, 
    'か': 0x6, 'き': 0x7, 'く': 0x8, 'け': 0x9, 'こ': 0xa, 
    'さ': 0xb, 'し': 0xc, 'す': 0xd, 'せ': 0xe, 'そ': 0xf, 
    'た': 0x10, 'ち': 0x11, 'つ': 0x12, 'て': 0x13, 'と': 0x14, 
    'な': 0x15, 'に': 0x16, 'ぬ': 0x17, 'ね': 0x18, 'の': 0x19, 
    'は': 0x1a, 'ひ': 0x1b, 'ふ': 0x1c, 'へ': 0x1d, 'ほ': 0x1e, 
    'ま': 0x1f, 'み': 0x20, 'む': 0x21, 'め': 0x22, 'も': 0x23, 
    'や': 0x24, 'ゆ': 0x25, 'よ': 0x26, 
    'ら': 0x27, 'り': 0x28, 'る': 0x29, 'れ': 0x2a, 'ろ': 0x2b, 
    'わ': 0x2c, 'を': 0x2d, 'ん': 0x2e, 
    'ぁ': 0x2f, 'ぃ': 0x30, 'ぅ': 0x31, 'ぇ': 0x32, 'ぉ': 0x33, 
    'ゃ': 0x34, 'ゅ': 0x35, 'ょ': 0x36,
    'が': 0x37, 'ぎ': 0x38, 'ぐ': 0x39, 'げ': 0x3a, 'ご': 0x3b,
    'ざ': 0x3c, 'じ': 0x3d, 'ず': 0x3e, 'ぜ': 0x3f, 'ぞ': 0x40,
    'だ': 0x41, 'ぢ': 0x42, 'づ': 0x43, 'で': 0x44, 'ど': 0x45,
    'ば': 0x46, 'び': 0x47, 'ぶ': 0x48, 'べ': 0x49, 'ぼ': 0x4a,
    'ぱ': 0x4b, 'ぴ': 0x4c, 'ぷ': 0x4d, 'ぺ': 0x4e, 'ぽ': 0x4f,
    'っ': 0x50,
    'ア': 0x51, 'イ': 0x52, 'ウ': 0x53, 'エ': 0x54, 'オ': 0x55,
    'カ': 0x56, 'キ': 0x57, 'ク': 0x58, 'ケ': 0x59, 'コ': 0x5a,
    'サ': 0x5b, 'シ': 0x5c, 'ス': 0x5d, 'セ': 0x5e, 'ソ': 0x5f,
    'タ': 0x60, 'チ': 0x61, 'ツ': 0x62, 'テ': 0x63, 'ト': 0x64,
    'ナ': 0x65, 'ニ': 0x66, 'ヌ': 0x67, 'ネ': 0x68, 'ノ': 0x69,
    'ハ': 0x6a, 'ヒ': 0x6b, 'フ': 0x6c, 'ヘ': 0x6d, 'ホ': 0x6e,
    'マ': 0x6f, 'ミ': 0x70, 'ム': 0x71, 'メ': 0x72, 'モ': 0x73,
    'ヤ': 0x74, 'ユ': 0x75, 'ヨ': 0x76,
    'ラ': 0x77, 'リ': 0x78, 'ル': 0x79, 'レ': 0x7a, 'ロ': 0x7b,
    'ワ': 0x7c, 'ヲ': 0x7d, 'ン': 0x7e,
    'ァ': 0x7f, 'ィ': 0x80, 'ゥ': 0x81, 'ェ': 0x82, 'ォ': 0x83,
    'ャ': 0x84, 'ュ': 0x85, 'ョ': 0x86,
    'ガ': 0x87, 'ギ': 0x88, 'グ': 0x89, 'ゲ': 0x8a, 'ゴ': 0x8b,
    'ザ': 0x8c, 'ジ': 0x8d, 'ズ': 0x8e, 'ゼ': 0x8f, 'ゾ': 0x90,
    'ダ': 0x91, 'ヂ': 0x92, 'ヅ': 0x93, 'デ': 0x94, 'ド': 0x95,
    'バ': 0x96, 'ビ': 0x97, 'ブ': 0x98, 'ベ': 0x99, 'ボ': 0x9a,
    'パ': 0x9b, 'ピ': 0x9c, 'プ': 0x9d, 'ペ': 0x9e, 'ポ': 0x9f,
    'ッ': 0xa0,
    '０': 0xa1, '１': 0xa2, '２': 0xa3,
    '３': 0xa4, '４': 0xa5, '５': 0xa6,
    '６': 0xa7, '７': 0xa8, '８': 0xa9,
    '９': 0xaa,
    '！': 0xab, '？': 0xac,
    '。': 0xad, 'ー': 0xae, '・': 0xaf, '‥': 0xb0,
    '『': 0xb1, '』': 0xb2, '「': 0xb3, '」': 0xb4,
    '♂': 0xb5, '♀': 0xb6,
    '円': 0xb7, '．': 0xb8, '×': 0xb9,
    '／': 0xba,
    'Ａ': 0xbb, 'Ｂ': 0xbc, 'Ｃ': 0xbd, 'Ｄ': 0xbe, 'Ｅ': 0xbf,
    'Ｆ': 0xc0, 'Ｇ': 0xc1, 'Ｈ': 0xc2, 'Ｉ': 0xc3, 'Ｊ': 0xc4,
    'Ｋ': 0xc5, 'Ｌ': 0xc6, 'Ｍ': 0xc7, 'Ｎ': 0xc8, 'Ｏ': 0xc9,
    'Ｐ': 0xca, 'Ｑ': 0xcb, 'Ｒ': 0xcc, 'Ｓ': 0xcd, 'Ｔ': 0xce,
    'Ｕ': 0xcf, 'Ｖ': 0xd0, 'Ｗ': 0xd1, 'Ｘ': 0xd2, 'Ｙ': 0xd3,
    'Ｚ': 0xd4,
    'ａ': 0xd5, 'ｂ': 0xd6, 'ｃ': 0xd7, 'ｄ': 0xd8, 'ｅ': 0xd9,
    'ｆ': 0xda, 'ｇ': 0xdb, 'ｈ': 0xdc, 'ｉ': 0xdd, 'ｊ': 0xde,
    'ｋ': 0xdf, 'ｌ': 0xe0, 'ｍ': 0xe1, 'ｎ': 0xe2, 'ｏ': 0xe3,
    'ｐ': 0xe4, 'ｑ': 0xe5, 'ｒ': 0xe6, 'ｓ': 0xe7, 'ｔ': 0xe8,
    'ｕ': 0xe9, 'ｖ': 0xea, 'ｗ': 0xeb, 'ｘ': 0xec, 'ｙ': 0xed,
    'ｚ': 0xee,
    '►': 0xef, '：': 0xf0, '＿': 0x00,
    'Ä': 0xf1, 'Ö': 0xf2, 'Ü': 0xf3,
    'ä': 0xf4, 'ö': 0xf5, 'ü': 0xf6,
    '\n': 0xFE, '\0': 0xff,
    ' ': 0x0,
    '0': 0xA1, '1': 0xA2, '2': 0xA3, '3': 0xA4, '4': 0xA5,
    '5': 0xA6, '6': 0xA7, '7': 0xA8, '8': 0xA9, '9': 0xAA,
    '!': 0xAB, '?': 0xAC, '¥': 0xB7, '·': 0xAF, '･': 0xAF,
    '-': 0xAE, '–': 0xAE, '…': 0xB0, '.': 0xB8, '/': 0xba,
    'A': 0xBB, 'B': 0xBC, 'C': 0xBD, 'D': 0xBE, 'E': 0xBF,
    'F': 0xC0, 'G': 0xC1, 'H': 0xC2, 'I': 0xC3, 'J': 0xC4,
    'K': 0xC5, 'L': 0xC6, 'M': 0xC7, 'N': 0xC8, 'O': 0xC9,
    'P': 0xCA, 'Q': 0xCB, 'R': 0xCC, 'S': 0xCD, 'T': 0xCE,
    'U': 0xCF, 'V': 0xD0, 'W': 0xD1, 'X': 0xD2, 'Y': 0xD3,
    'Z': 0xD4, 
    'a': 0xD5, 'b': 0xD6, 'c': 0xD7, 'd': 0xD8, 'e': 0xD9,
    'f': 0xDA, 'g': 0xDB, 'h': 0xDC, 'i': 0xDD, 'j': 0xDE,
    'k': 0xDF, 'l': 0xE0, 'm': 0xE1, 'n': 0xE2, 'o': 0xE3,
    'p': 0xE4, 'q': 0xE5, 'r': 0xE6, 's': 0xE7, 't': 0xE8,
    'u': 0xE9, 'v': 0xEA, 'w': 0xEB, 'x': 0xEC, 'y': 0xED,
    'z': 0xEE, ':': 0xF0, '_': 0x00, '␣': 0x00,
}


CHARACTER_MAP_R_NON_JPN = {
    ' ': 0x0, 'À': 0x1, 'Á': 0x2, 'Â': 0x3, 'Ç': 0x4,
    'È': 0x5, 'É': 0x6, 'Ê': 0x7, 'Ë': 0x8, 'Ì': 0x9,
    'Î': 0xB, 'Ï': 0xC, 'Ò': 0xD, 'Ó': 0xE, 'Ô': 0xF,
    'Œ': 0x10, 'Ù': 0x11, 'Ú': 0x12, 'Û': 0x13, 'Ñ': 0x14,
    'ß': 0x15, 'à': 0x16, 'á': 0x17, 'ç': 0x19, 'è': 0x1A,
    'é': 0x1B, 'ê': 0x1C, 'ë': 0x1D, 'ì': 0x1E, 'î': 0x20,
    'ï': 0x21, 'ò': 0x22, 'ó': 0x23, 'ô': 0x24, 'œ': 0x25,
    'ù': 0x26, 'ú': 0x27, 'û': 0x28, 'ñ': 0x29, 'º': 0x2A,
    'ª': 0x2B, '&': 0x2D, '+': 0x2E, '=': 0x35, ';': 0x36,
    '▯': 0x50, '¿': 0x51, '¡': 0x52, 'Í': 0x5A, '%': 0x5B,
    '(': 0x5C, ')': 0x5D, 'â': 0x68, 'í': 0x6F, '↑': 0x79,
    '↓': 0x7A, '←': 0x7B, '→': 0x7C, 'ᵉ': 0x84,
    '<': 0x85, '>': 0x86, '0': 0xA1, '1': 0xA2, '2': 0xA3,
    '3': 0xA4, '4': 0xA5, '5': 0xA6, '6': 0xA7, '7': 0xA8,
    '8': 0xA9, '9': 0xAA, '!': 0xAB, '?': 0xAC, '.': 0xAD,
    '-': 0xAE, '·': 0xAF, '…': 0xB0, '“': 0xB1, '”': 0xB2,
    '‘': 0xB3, '’': 0xB4, '♂': 0xB5, '♀': 0xB6, '$': 0xB7,
    ',': 0xB8, '×': 0xB9, '/': 0xBA, 'A': 0xBB, 'B': 0xBC,
    'C': 0xBD, 'D': 0xBE, 'E': 0xBF, 'F': 0xC0, 'G': 0xC1,
    'H': 0xC2, 'I': 0xC3, 'J': 0xC4, 'K': 0xC5, 'L': 0xC6,
    'M': 0xC7, 'N': 0xC8, 'O': 0xC9, 'P': 0xCA, 'Q': 0xCB,
    'R': 0xCC, 'S': 0xCD, 'T': 0xCE, 'U': 0xCF, 'V': 0xD0,
    'W': 0xD1, 'X': 0xD2, 'Y': 0xD3, 'Z': 0xD4, 'a': 0xD5,
    'b': 0xD6, 'c': 0xD7, 'd': 0xD8, 'e': 0xD9, 'f': 0xDA,
    'g': 0xDB, 'h': 0xDC, 'i': 0xDD, 'j': 0xDE, 'k': 0xDF,
    'l': 0xE0, 'm': 0xE1, 'n': 0xE2, 'o': 0xE3, 'p': 0xE4,
    'q': 0xE5, 'r': 0xE6, 's': 0xE7, 't': 0xE8, 'u': 0xE9,
    'v': 0xEA, 'w': 0xEB, 'x': 0xEC, 'y': 0xED, 'z': 0xEE,
    '►': 0xEF, ':': 0xF0, 'Ä': 0xF1, 'Ö': 0xF2, 'Ü': 0xF3,
    'ä': 0xF4, 'ö': 0xF5, 'ü': 0xF6,
    '\n': 0xFE, '\0': 0xFF,
    '‥': 0xB0, '–': 0xAE, '･': 0xAF, '・': 0xAF,
    '_': 0x00, '␣': 0x00,
}

def build_character_map_r(version: Version, langauge: Language) -> dict[str, int]:
    character_map = (
        CHARACTER_MAP_R_NON_JPN.copy() 
        if langauge is not Language.JPN
        else CHARACTER_MAP_R_JPN.copy()
        )
    if (
        langauge is Language.JPN
        and (
            version is Version.RUBY
            or version is Version.SAPPHIRE
        )
    ):
        character_map['↑'] = 0xF7
        character_map['↓'] = 0xF8
        character_map['←'] = 0xF9
    if langauge is Language.FRA:
        character_map.pop('“')
        character_map.pop('”')
        character_map['«'] = 0xB1
        character_map['»'] = 0xB2
    if langauge is Language.GER:
        character_map.pop('“')
        character_map.pop('”')
        character_map['„'] = 0xB1
        character_map['“'] = 0xB2
    if (
        langauge is not Language.JPN
        and (
            version is Version.RUBY
            or version is Version.SAPPHIRE
        )
    ):
        japanese_map = build_character_map(version, Language.JPN)
        used_codepoints = build_character_map(version, langauge)
        unused_codepoints = [
            x for x in range(0x0, 1 << 8)
            if x not in used_codepoints
        ]
        for codepoint in unused_codepoints:
            if codepoint in japanese_map:
                character_map[japanese_map[codepoint]] = codepoint
    return character_map


def to_bytes(data: str, version: Version, language: Language):
    character_map = build_character_map_r(version, language)
    return bytes(character_map[c] for c in data.replace('�', ' '))
